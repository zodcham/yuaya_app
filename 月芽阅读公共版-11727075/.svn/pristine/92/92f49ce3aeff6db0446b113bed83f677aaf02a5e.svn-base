document.write("<script src='http://www.readseed.cn/nocache/js_student/js/common_new.js?time="+ (new Date().getTime()) +"'></"+"script>");

appcan.ready(function() {
    getUserInfo();
    getCommInfo();

    getSysInfo();
    LoadAll();




})



appcan.button("#bookshelf", "btn-act", function() {
    appcan.window.open("bookList", "user/user_book_list.html", 5);
});
function openTask(){
    getCommInfo();
    commInfo.finishState = '0';
    setCommInfo();
    appcan.window.open("user_read_tasks", "user/user_read_taskss.html", 5);
}
appcan.button("#mytasks", "btn-act", function() {
    openTask();
});
appcan.button("#review", "btn-act", function() {
    appcan.window.open("book_review_history", "book/book_review_historys.html", 5);
});
appcan.button("#report", "btn-act", function() {
    appcan.window.open("user_report_search", "user/user_report_search.html", 5);
});


function LoadAll() {
    /*读数据库版本*/
    $("#name").html(userInfo.name);
    var time1 = new Date().format("HH:mm:ss");

    var par = {};
    var url = _SERVER_ADDRESS + "/phone/newindex";
    var ferr = function(err) {

    };

    var fok = function(data) {

        data = JSON.parse(data);

        LoadNews(data.xw);
        LoadVideo(data.ddsp);
        LoadAudio(data.jdzy);

        LoadCourse(data.kcld);

    };
    common.ajaxPOST(url, par, fok, ferr);
}


//新闻
function LoadNews(data) {
    var index = 0;
    var shtml = '';
    for (var i = 0; i < data.length; i++) {
        var obj = data[i];
        var objNews = $("#item_news").clone();
        objNews.attr("id", obj.id);
        objNews.removeClass("uhide");
        var newstitle = obj.name.substring(0, 16);
        objNews.find(".news_title").html(newstitle);
        objNews.find(".news_author").html("月芽阅读");
        objNews.find(".news_date").html(obj.date);
        var imgUrl=_SERVER_ADDRESS+obj.image;
        objNews.find(".news_pic").attr("src",imgUrl);

        objNews.bind("click", function() {
            var id = $(this).attr("id");
            getProgramInfoById(id, function(data) {
                getProgramInfo();
                programInfo = data;
                setProgramInfo();
                appcan.window.open("information", "information.html", 5);

            }, null);
        });

        $("#news_list").append(objNews);

    }

}


//视频
function LoadVideo(data) {
    for (var i = 0; i < data.length; i++) {
        var obj = data[i];
        var objNews = $("#itemVideo").clone();
        objNews.attr("id", obj.id);
        objNews.removeClass("uhide");
        var newstitle = obj.name.substring(0, 16);
        var imgUrl=_SERVER_ADDRESS+obj.image;
        objNews.find(".videoTitle").html(newstitle);
        objNews.find(".videoImage").html('<img src="'+ imgUrl +'" style="height:143px;width:98px;margin-top:12px;margin-left:17px;">');

        objNews.bind("click", function() {
            var id = $(this).attr("id");
            getBookInfoById(userInfo.id, id, function(data) {
                getBookInfo();
                bookInfo = data;
                setBookInfo();
                setLocVal("bookInfo_default","video");
                appcan.window.open("book_default", "book/book_default.html", 5);
            }, null);
        });

        $("#videoList").append(objNews);

    }

    //$("#news_list").html(shtml);

}


//视频
function LoadAudio(data) {
    for (var i = 0; i < data.length; i++) {
        var obj = data[i];
        var objNews = $("#itemAudio").clone();
        objNews.attr("id", obj.id);
        objNews.removeClass("uhide");
        var newstitle = obj.name.substring(0, 16);
        var imgUrl=_SERVER_ADDRESS+obj.image;
        objNews.find(".audioTitle").html(newstitle);
        objNews.find(".audioImage").html('<img src="'+ imgUrl +'" style="height:156px;width:160px;margin-top:0px;margin-left:19px;">');

        objNews.bind("click", function() {
            var id = $(this).attr("id");
            getProgramInfoById(id, function(data) {
                getProgramInfo();
                programInfo = data;
                setProgramInfo();
                appcan.window.open("column_index", "book/column_index.html", 5);
            }, null);
        });

        $("#audioList").append(objNews);

    }

    //$("#news_list").html(shtml);

}



//课程领读
function LoadCourse(data) {
    var len = data.length;
    var objList=[];
    var imageList=[];
    for (var i = 0; i < len; i++) {
        var obj = data[i];
        objList.push({
            "grade" : obj.month,
            "name" : obj.name,
            "report" : obj.year
        });
        imageList.push(_SERVER_ADDRESS + obj.image);


        /*
        ReadItem.bind("click", function() {
            var month = $(this).attr("month");
            var name = $(this).attr("name");
            var report = $(this).attr("year");

            getSysInfo();
            sysInfo.ranking = {
                "grade" : month,
                "name" : name,
                "report" : report
            };
            setSysInfo();

            appcan.window.open("Readcontent", "yueduquan/Readcontents.html", 5);

        });
        */

    }

    // var params = {
    //     x: 87,
    //     y: 380,
    //     width: 920,
    //     height: 265,
    //     isScrollWithWeb: true,
    //     placeholderImage: imageList[0],
    //     imageUrl: imageList
    // };
    // var coverFlow = uexCoverFlow2.create(JSON.stringify(params));

    var param={
        interval:1000,
        anchor:["87", "380"],
        height:265,
        width:920,
        urls:imageList
    };
    var view1=uexScrollPicture.createNewScrollPicture(param);

    uexScrollPicture.startAutoScroll(JSON.stringify({
        view:view1
    }));



}