<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/main.css" />
        <style>
            .nav {
                overflow: visible;
                -webkit-transition: color 0.2s;
                transition: color 0.2s;
                padding: 0.5em 0em 0.5em 0;
                color: #555555;
                background: #FFFFFF;
                font-weight: bold;
            }
            .txt-ellipsis{ 
                overflow:hidden;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                word-break: break-all;
            }
            .tabcurrent {
                color: #4dba72;
            }
            .bottom{
                height:0.3em;
            }
            .tabcurrent .bottom{
                background:url(css/image1/ico_shuchengxiangqing@2x_r13_c3.png) no-repeat;
                background-size: 100% 100%;
            }

            
            .icon_into {
                width:1em;
                height:1em;
                background: url(css/icons/btn_into.png) no-repeat;
                background-size: 100% 100%;
            }
            .icon_remove {
                width:1em;
                height:1em;
                background: url(css/icons/btn_remove.png) no-repeat;
                background-size: 100% 100%;
            }
            .head_btn_box {
                /*background: url(../css/image1/ico_shuchengxiangqing@2x_r10_c12.png) no-repeat;
                background-size: 100% 100%;*/
                background: #FE8100;
            }
                 .click2:active {
                 background: #F16412;
             }
             .mark_self {
                 width:3em;
                 height:3em;
                 background: url(css/icons/mark_self.png) no-repeat;
                 background-size: 100% 100%;
             }
             .mark_selective {
                 width:3em;
                 height:3em;
                 background: url(css/icons/mark_selective.png) no-repeat;
                 background-size: 100% 100%;
             }
             .mark_integrant {
                 width:3em;
                 height:3em;
                 background: url(css/icons/mark_integrant.png) no-repeat;
                 background-size: 100% 100%;
             }
             .ico_integral {
                 width:1.2em;
                 height:1.2em;
                 background: url(css/image1/ico_shucheng@2x_r10_c15.png) no-repeat;
                 background-size: 100% 100%;
             }
             
             .icon_like {
                width:1em;
                height:1em;
                background: url(css/image1/ico_shuchengduhougan@2x_r3_c6.png) no-repeat;
                background-size:  100% 100%;
            }
            .icon_like_pressed {
                width:1em;
                height:1em;
                background: url(css/image1/ico_shuchengduhougan@2x_r3_c6.png) no-repeat;
                background-size:  100% 100%;
            }
            .icon_comment {
                width:1em;
                height:1em;
                background: url(css/image1/ico_shuchengduhougan@2x_r3_c4.png) no-repeat;
                background-size:  100% 100%;
            }
            .click2:active {
                background: rgba(0,0,0,0.1);
            }
            .icon_commentss {
                width:1em;
                height:1em;
                background: url(css/image1/zhuanfa.png) no-repeat;
                background-size:  100% 100%;
            } 
                 
         .icon_wx{
                width:2em;
                height:2em;
                background: url(css/icons/icon_wx.png) no-repeat;
                background-size: 100% 100%;
            }
         .icon_res{
               width:2em;
                height:2em;
                background: url(css/icons/icon_res.png) no-repeat;
                background-size: 100% 100%;
          }          
                 
        </style>
    </head>
    <body class="um-vp " ontouchstart>
        <div id="page_0" class="up ub ub-ver sc-bg" tabindex="0">
            <!--header开始-->
            <div id="header" class="ub ub-ver" style="background:url(css/image1/ico_shuchengxiangqing@2x_r25_c1.png) no-repeat;background-size: 100% 100%;">
                <div class="uh bc-text-head ub">
                    <div class="nav-btn" id="nav-left">
                    <div class="fa icon-back fa-w fa-lg"></div>
                    </div>
                    <h1 class="ut ub-f1 ulev-3 ut-s tx-c bookName " tabindex="0">&nbsp;</h1>
                    <div class="nav-btn nav-bt" id="nav-right"></div>
                </div>                                                                       
                <div class="ub ub-ac ub-pc tab umar-t bc-border ubb bc-white">
                    <div class="ub ub-ac ub-pc ub-f1 ub-ver nav tabcurrent">
                        <span class="ub">内容</span>
                        <div class="ub ub-fh bottom umar-t"></div>
                    </div>
                    <div class="ub ub-ac ub-pc ub-f1 nav ub-ver">
                        <span class="ub">评论</span>
                        <div class="ub ub-fh bottom umar-t"></div>
                    </div>
                    <div class="ub ub-ac ub-pc ub-f1 nav ub-ver">
                        <span class="ub">读后感</span>
                        <div class="ub ub-fh bottom umar-t"></div>
                    </div>
                </div>
                </div>                           
            <!--header结束--><!--content开始-->
            <div id="content" class="ub-f1 tx-l">
                
 
            </div>
            <!--content结束-->
            <!--footer开始-->
            <div id="footer"  class="ub c-wh ub-ac ubt bc-border">
               <div class="tabs ub ub-ac ub-fh ub-pc ub-f1">           
                    <div  class="ub ub-ac ub-pc ub-f1 sc-text bc-white bc-border ubt ubb" style="height:2.6em;width: 100%">                    
                       <div class="ub umar-l" id="wedpageUrl0" style="border-radius: 0.2em; ">
                    <div class="ub ub-f1 ub-ac ub-pc" style="padding: 0.5em">
                          <div class="ub icon icon_wx"></div>
                        <div class="ub" style="color: #342864">转发微信好友</div>
                    </div>
                </div>
                         <div class="ub ub-ac tx-r ub-pc" style="color: #3eb173;width: 50%;height:2.6em;" > 
                            
                          <div class="ub umar-" id="wedpageUrl1" style="border-radius: 0.2em; ">
                    <div class="ub ub-f1 ub-ac ub-pc" style="padding: 0.5em">
                          <div class="ub icon icon_res"></div>
                        <div class="ub" style="color: #342864">转发朋友圈</div>
                    </div>
                </div>
                         </div>
                    </div>
                </div>
             </div>
            <!--footer结束-->   
        </div>

        <script src="js/appcan.js"></script>
        <script src="js/appcan.control.js"></script>
        <script src="js/jquery-1.8.3.min.js"></script>
        <script src="js/common.js"></script>
        <script src="js/entity.js"></script>
    </body>
    <script>
        var dicList={"grade":[],"book_category":[],"recommendLevel":[]};
        var titHeight;
        var isOpenComments=false;
        
        function isLoadDic(){
            getCommInfo();
            if (commInfo.grade.length == 0)
            {
                return false;
            }
            if (commInfo.book_category.length == 0)
            {
                return false;
            }
            if (commInfo.recommendLevel.length == 0)
            {
                return false;
            }
            return true;
        }
        
        function loadDic(){
            if (isLoadDic())
            {
                setBookInfo();
                return;
            }
            $.each(dicList,function(n,obj){
                if(!obj||obj.length==0){
                    loadDicData(n);
                    return false;
                }
            });
        }
        function loadDicData(name){
          var params={ "type": name};
            common.ajax("/dict/getDictList", {
               params:JSON.stringify(params)
            }, function(data) {
                var dicObj = {};
                for(var i=0;i<data.obj.length;i++){
                    var obj=data.obj[i];
                    dicObj[obj.value] = obj.label;
                }
            
                dicList[name] = dicObj;
                commInfo[name] = dicObj;
                setCommInfo();
                loadDic();
            }, function(data){
                toast(getMsgByKey(data.msg),config.toastTimeShort);
            });
        }
        
        appcan.ready(function() {
            getUserInfo();
            getBookInfo();
            getCommInfo();
             titHeight = $('#header').offset().height;
               uexWindow.onKeyPressed = function(keyCode) {
                if (keyCode == 0) {
                    if (isOpenComments) {
                        uexWindow.evaluatePopoverScript("","book_comments","exit();");
                    } else {
                    exit();
                    }
                }
            }
            uexWindow.setReportKey(0, 1);
            $(".nav").on("click", function() {
                $(".tab .tabcurrent").removeClass("tabcurrent");
                $(this).addClass("tabcurrent");
                appcan.window.selectMultiPopover("content",$(this).index());
            });
            init();
            $(".bookName").html(bookInfo.name);
           
          
             loadDic();
             
             var j = 0;
             var star=bookInfo.score;
             for (; j < parseInt(star/ 2); j++) {
                $("#info-star .fa").eq(j).removeClass("icon-star-five-hollow").addClass("icon-star-five");
             }
             star =Math.round(bookInfo.score-star);
             if(star==1){
                $("#info-star .fa").eq(j).removeClass("icon-star-five-hollow").addClass("icon-star-five-half");
             }
             setView();
                //$("#info-star")
                //bookInfo.score
                
       uexWeiXin.registerApp(appId);     
            
          uexWeiXin.cbRegisterApp = function (opCode,dataType,data){
                if(data == "1"){
                  //  alert('注册失败！');
                }
                if(data == "0"){
                   // alert('注册成功！');
                }
            }
               uexWeiXin.cbShareLinkContent = function(data) {
                    if(data=="0"){                   
                       appcan.window.alert({
                            title : '提示信息！',
                            content :'分享成功~',
                            buttons : '确定',
                                         
                        });
                    }else{                   
                        appcan.window.alert({
                            title : '提示信息！',
                            content :'分享失败~',
                            buttons : '确定',
                                         
                        });
                    }
              };
        });
          appcan.button("#btnAdd", "btn-act", function() {
            appcan.window.open("book_comments_add","book/book_comments_add.html",10);
        })
        
         
        function setBookInfo()
        {
             if (bookInfo.recommendLevel.length == 0)
             {
                  $(".recommendLevel").addClass("uhide");
             }
             else
             {
                $(".recommendLevel").html(commInfo.recommendLevel[bookInfo.recommendLevel]);
             }
             if (bookInfo.bookCategory.length == 0)
             {
                  $(".bookCategory").addClass("uhide");
             }
             else
             {
                $(".bookCategory").html(commInfo.book_category[bookInfo.bookCategory]);
             }
             $(".grade").html(commInfo.grade[bookInfo.grade]);
        }
        
        function setView(){
            if(bookInfo.isFavorite=="1"){
                 //$(".favorite").removeClass("icon_into").addClass("icon_remove");
                 $(".favorite .txt").html("移出书架");
             }else{  
                 //$(".favorite").removeClass("icon_remove").addClass("icon_into");
                 $(".favorite .txt").html("加入书架");
             }
        }
         function init(){
           titHeight =$('#header')[0].offsetHeight;
            appcan.frame.open({
                id : "content",
                url : [{'inPageName':'introduce','inUrl':'yuedu_index_introduce_content.html'},{'inPageName':'comments','inUrl':'yuedu_index_comments_content.html'},{'inPageName':'content','inUrl':'yuedu_index_content.html'}],
                top : titHeight,
                left : 0,
                index : 0,
                change:function(index,res){
                   $(".tab .tabcurrent").removeClass("tabcurrent");
                   $(".nav:eq("+res.multiPopSelectedIndex+")").addClass("tabcurrent");
                }
            });
            window.onorientationchange = window.onresize = function() {
                appcan.frame.resize("content", 0, titHeight);
            };
        }
        
        appcan.button("#nav-left", "btn-act", function() {
           exit();
        })
        
        appcan.button(".favorite", "btn-act", function() {
            if(bookInfo.isFavorite=="1"){ 
                var params={ 'userId' : userInfo.id,'bookId' : bookInfo.id};
                common.ajax("/favorite/remove", {
                   params:JSON.stringify(params)
                }, function(data) {
                    bookInfo.isFavorite="0";
                    setBookInfo();
                    setView();
                    toast("已移出书架~",config.toastTimeShort);
                }, function(data){
                    toast(getMsgByKey(data.msg),config.toastTimeShort);
                }, {
                    type : 'POST'
                });
            }else{
                var params={ 'userId' : userInfo.id,'bookId' : bookInfo.id};
                common.ajax("/favorite/add", {
                   params:JSON.stringify(params)
                }, function(data) {
                    bookInfo.isFavorite="1";
                    setBookInfo();
                    setView();
                    toast("已加入书架~",config.toastTimeShort);
                }, function(data){
                    toast(getMsgByKey(data.msg),config.toastTimeShort);
                }, {
                    type : 'POST'
                });
            }
        });
        
        function exit() {
            //setOrientation(1);
             
            appcan.window.close(-1);
            //uexWindow.evaluatePopoverScript("","introduce","closePlayer();");
        }
        
        function setOrientation(type){
            uexWindow.setOrientation(type);
        }
           
        appcan.button("#nav-left", "btn-act", function() {
            appcan.window.close(-1);
        })
 
        appcan.button("#Forward", "btn-act", function() {
           Forward();    
        })
        // uinputs
        
         // 教师   用户分享链接
    //var appId = "wxdd94041dd73a8049";
   // var app_serect = "9e2ce31ee8b9855b4f7ce5a4d4854c75";
   // var app_key = "a0ad0cca-70b6-4dfc-8dff-2f8eb43698ce"; 
    
    // 学生   用户分享链接
     var appId = "wx009651c6fd586eb2";
      
      appcan.button("#wedpageUrl0", "btn-act", function() {
          $("#divAddImg").addClass("uhide");  
       var jsonstr0 = '{"thumbImg":"http://www.readseed.cn/yueya_webapp/icon.png","wedpageUrl":"http://www.readseed.cn/yueya_webapp/yuedu_index.html?'+userInfo.id+'?'+bookInfo.id+'?","scene":"0","title":"'+bookInfo.name+'","description":"分享一下"}';
            uexWeiXin.shareLinkContent(jsonstr0);
      })
      
       appcan.button("#wedpageUrl1", "btn-act", function() {
          $("#divAddImg").addClass("uhide");  
      var jsonstr1 = '{"thumbImg":"http://www.readseed.cn/yueya_webapp/icon.png","wedpageUrl":"http://www.readseed.cn/yueya_webapp/yuedu_index.html?'+userInfo.id+'?'+bookInfo.id+'?","scene":"1","title":"'+bookInfo.name+'","description":"分享一下"}';
            uexWeiXin.shareLinkContent(jsonstr1);
      })
      
     $(".btnCancel").on("click",function(){
            closeAddImg();
      });
      
     function closeAddImg(){       
      uexWindow.evaluateScript("",0,"isOpenChooseImg=true;");
       $("#divAddImg").addClass("uhide");                                                                             
     } 
      
 </script>
</html>