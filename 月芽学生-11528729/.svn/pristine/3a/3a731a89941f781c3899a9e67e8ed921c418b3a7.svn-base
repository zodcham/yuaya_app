<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../css/ui-box.css">
        <link rel="stylesheet" href="../css/ui-base.css">
        <link rel="stylesheet" href="../css/ui-color.css">
        <link rel="stylesheet" href="../css/appcan.icon.css">
        <link rel="stylesheet" href="../css/appcan.control.css">
        <style>
            .pie-legend .label
            {
                font-size: 0.8em;
            }
        </style>
    </head>
    <body class="um-vp sc-bg" ontouchstart>
        <div id="main" class="ub ub-fh ub-fv ub-ver">
            <div class="ub ub-f1 ub-ver">
                <div class="ub ub-fh ub-ver">
                     <div class="ub ub-fh umar-t umar-b">
                         <div class="ub ub-f1 uinn ub-ac">
                             <div class="ub " style="background: url(../css/image1/ico_jibenqingkuang@2x_03.png) no-repeat;background-size: 100% 100%;width:1.5em;height:1.5em"></div>
                             <div class="ub umar-l">阅读任务情况分析</div>
                         </div>
                     </div>
                     <div class="ub ub-fh bc-border ubt">
                        <div class="ub ub-f1 ub-ver uinn">
                            <div class="ub ub-fh">
                                <div class="ub ub-ac ub-pc ulev-1" style="background: #f6d33e;border-radius:1.5em;height:1.5em;width:7em">任务完成率</div>
                                <div class="ub ub-f1"></div>
                                <div class="ub">
                                    <div class="ub">（</div>
                                    <div class="ub bookCountRateName1" style="color:#7ac677">0本</div>
                                    <div class="ub">/</div>
                                    <div class="ub bookCountRateName2" style="color:#000000">0本</div>
                                    <div class="ub">）</div>
                                </div>
                            </div>
                            <div class="ub ub-ac ub-f1 ub-fh value umar-t">
                                <div class="ub ub-f1" style="height: 0.5em;background: rgba(0,0,0,0.1);border:0px solid #BABABA;border-radius: 0.5em">
                                    <div class="ub ub-f1" style="position: relative">
                                        <div class="ub bookCountRate" style="width:0%;border-radius: 0.5em;background: #a8e76d"></div>
                                        <div class="ub ub-f1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                     <div class="ub ub-fh ">
                        <div class="ub ub-f1 ub-ver uinn">
                            <div class="ub ub-fh">
                                <div class="ub ub-ac ub-pc ulev-1" style="background: #f7b63e;border-radius:1.5em;height:1.5em;width:7em">字数完成率</div>
                                <div class="ub ub-f1"></div>
                                <div class="ub">
                                    <div class="ub">（</div>
                                    <div class="ub wordCountRateName1" style="color:#7ac677">0千字</div>
                                    <div class="ub">/</div>
                                    <div class="ub wordCountRateName2" style="color:#000000">0千字</div>
                                    <div class="ub">）</div>
                                </div>
                            </div>
                            <div class="ub ub-ac ub-f1 ub-fh value umar-t">
                                <div class="ub ub-f1" style="height: 0.5em;background: rgba(0,0,0,0.1);border:0px solid #BABABA;border-radius: 0.5em">
                                    <div class="ub ub-f1" style="position: relative">
                                        <div class="ub wordCountRate" style="width:0%;border-radius: 0.5em;background: #a8e76d"></div>
                                        <div class="ub ub-f1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                     <div class="ub ub-fh ">
                        <div class="ub ub-f1 ub-ver uinn">
                            <div class="ub ub-fh">
                                <div class="ub ub-ac ub-pc ulev-1" style="background: #3ebaf7;border-radius:1.5em;height:1.5em;width:7em">读后感完成率</div>
                                <div class="ub ub-f1"></div>
                                <div class="ub">
                                    <div class="ub">（</div>
                                    <div class="ub reviewRateName1" style="color:#7ac677">0篇</div>
                                    <div class="ub">/</div>
                                    <div class="ub reviewRateName2" style="color:#000000">0偏</div>
                                    <div class="ub">）</div>
                                </div>
                            </div>
                            <div class="ub ub-ac ub-f1 ub-fh value umar-t">
                                <div class="ub ub-f1" style="height: 0.5em;background: rgba(0,0,0,0.1);border:0px solid #BABABA;border-radius: 0.5em">
                                    <div class="ub ub-f1" style="position: relative">
                                        <div class="ub reviewRate" style="width:0%;border-radius: 0.5em;background: #a8e76d"></div>
                                        <div class="ub ub-f1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                </div>
                
                <div class="ub ub-fh ub-ver">
                     <div class="ub ub-fh umar-t umar-b bc-border ubb">
                         <div class="ub ub-f1 uinn ub-ac">
                             <div class="ub " style="background: url(../css/image1/ico_jibenqingkuang@2x_03-02.png) no-repeat;background-size: 100% 100%;width:1.5em;height:1.5em"></div>
                             <div class="ub umar-l">阅读基本情况</div>
                         </div>
                     </div>
                     <div class="ub ub-fh bc-border ubb ubt sc-text">
                        <div class="ub ub-f1 uinn">
                            <div class="ub ub-ac ub-pe name ulev-1" style="width: 6em;color:#000000">阅读书本数：</div>
                            <div class="ub ub-ac ub-f1 value bookCount"></div>
                        </div>
                     </div>
                     <div class="ub ub-fh bc-border ubb sc-text">
                        <div class="ub ub-f1 uinn">
                            <div class="ub ub-ac ub-pe name ulev-1" style="width: 6em;color:#000000">阅读字数：</div>
                            <div class="ub ub-ac ub-f1 value wordCount"></div>
                        </div>
                     </div>
                     <div class="ub ub-fh bc-border ubb sc-text">
                        <div class="ub ub-f1 uinn">
                            <div class="ub ub-ac ub-pe name ulev-1" style="width: 6em;color:#000000">获得积分：</div>
                            <div class="ub ub-ac ub-f1 value score"></div>
                        </div>
                     </div>
                     <div class="ub ub-fh bc-border ubb sc-text">
                        <div class="ub ub-f1 uinn">
                            <div class="ub ub-ac ub-pe name ulev-1" style="width: 6em;color:#000000">读后感：</div>
                            <div class="ub ub-ac ub-f1 value reviewCount"></div>
                        </div>
                     </div>
                </div>
                
                <div class="ub ub-fh ub-ver">
                     <div class="ub ub-fh umar-t umar-b bc-border ubb">
                         <div class="ub ub-f1 uinn ub-ac">
                             <div class="ub " style="background: url(../css/image1/ico_jibenqingkuang@2x_03-03.png) no-repeat;background-size: 100% 100%;width:1.5em;height:1.5em"></div>
                             <div class="ub umar-l">阅读质量分析</div>
                         </div>
                     </div>
                     <div class="ub ub-fh bc-border ubt">
                        <div class="ub ub-f1 uinn">
                            <div class="ub ub-f1 ub-ac ub-pc charts" id="readQuality"></div>
                        </div>
                     </div>
                </div>
                
                <div class="ub ub-fh ub-ver">
                     <div class="ub ub-fh umar-t umar-b">
                         <div class="ub ub-f1 uinn ub-ac">
                             <div class="ub " style="background: url(../css/image1/ico_jibenqingkuang@2x_03-04.png) no-repeat;background-size: 100% 100%;width:1.5em;height:1.5em"></div>
                             <div class="ub umar-l">阅读内容分析</div>
                         </div>
                     </div>
                     <div class="ub ub-fh bc-border ubt">
                        <div class="ub ub-f1 uinn">
                            <div id="readContent" class="ub ub-f1 ub-ac ub-pc charts">
                            </div>
                        </div>
                     </div>
                </div>
                
            </div>
        </div>
    </body>
    <script src="../js/appcan.js"></script>
    <script src="../js/appcan.control.js"></script>
    <script src="../js/jquery-1.8.3.min.js"></script>
    <script src="../js/echarts.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/entity.js"></script>
    <script src="../js/tool.js"></script>
    </body>
    <script>
        var chartWidth;
        var fs = 30;
        appcan.ready(function() {
            getUserInfo();
            getSysInfo();
            chartWidth = $("#main").width() * 0.8;
            $(".charts").css("width",chartWidth+"px").css("height",chartWidth+"px");
            fs = (window.screen.width/800) * 30;
            loadInfo();
        });
        
        //根据查询信息获取阅读报告情况
        function loadInfo(){
            var params={'userId':userInfo.id,'beginDate': sysInfo.report.startDate, 'endDate': sysInfo.report.endDate};
            common.ajax("/readingReport/get", {
               params:JSON.stringify(params)
            }, 
            function(data) 
            {
                createReadQuality(data.obj.exerciseChatInfo);
                createReadContent(data.obj.categoryReadChatInfo);
                
                $(".bookCount").html(data.obj.bookCount+"本");
                $(".wordCount").html(data.obj.wordCount+"千字");
                $(".reviewCount").html(data.obj.reviewCount+"篇");
                $(".score").html(data.obj.score+"分");
                $(".bookCountRateName1").html(data.obj.taskFinishBookCount+"本");
                $(".bookCountRateName2").html(data.obj.taskBookCount+"本");
                $(".bookCountRateName1").html(data.obj.taskFinishBookCount+"本");
                $(".bookCountRateName2").html(data.obj.taskBookCount+"本");
                $(".wordCountRateName1").html(data.obj.taskFinishWordCount+"千字");
                $(".wordCountRateName2").html(data.obj.taskWordCount+"千字");
                $(".reviewRateName1").html(data.obj.taskFinishReviewCount+"篇");
                $(".reviewRateName2").html(data.obj.taskReviewCount+"篇");
                var bookCountRate = data.obj.taskFinishBookCount / data.obj.taskBookCount * 100;
                var wordCountRate = data.obj.taskFinishWordCount / data.obj.taskWordCount * 100;
                var reviewRate = data.obj.taskFinishReviewCount / data.obj.taskReviewCount * 100;
                $(".bookCountRate").css("width",bookCountRate+"%");
                $(".wordCountRate").css("width",wordCountRate+"%");
                $(".reviewRate").css("width",reviewRate+"%");
                /*
                 * obj : {
                    student :  : '学生信息'
                    monthCount : '查询间隔月份的数量'
                
                    taskBookCount : '本时段阅读任务书本数量'
                    taskFinishBookCount : '本时段阅读任务书本完成数量'
                    taskWordCount : '本时段阅读任务书本字数'
                    taskFinishWordCount : '本时段阅读任务已读书本字数'
                
                    taskReviewCount : '本时段阅读任务读后感数量'
                    taskFinishReviewCount : '本时段阅读任务读后感数量'
                
                    bookCount : '本时段阅读书本数量'
                    wordCount : '本时段阅读书本字数'
                
                    reviewCount : '本时段读后感数量'
                    reviewLikes : '本时段读后感点赞数'
                    score : '本时段获得积分数'
                
                }
                */
                
            }, 
            function(data){
                toast(getMsgByKey(data.msg),config.toastTimeShort);
                
            });
            
        }
       
       
       //创建阅读质量分析报表
       function createReadQuality(data){
            var myChart = echarts.init(document.getElementById('readQuality'));
            var labels = data.labels;
            var values = data.values;
            var dataValue=[];
            for(var i = 0 ; i < values.length ; i ++)
            {
                var color = getRandomColor();
                var obj = {
                    value:values[i],
                    name:labels[i]
                };
                dataValue.push(obj);
             }
            var myLabels = [];
             for(var i = 0 ; i < labels.length ; i ++) {
                 var obj = {"name":labels[i],"textStyle":{color:'#96de3a',fontSize:fs}};
                 myLabels.push(obj);
                 myLabels.push(labels[i]);
             }
            var option = {
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'horizontal',
                        left: 'left',
                        data:myLabels
                    },
                    series : [
                        {
                            name: '阅读质量',
                            type: 'pie',
                            radius : '55%',
                            center: ['50%', '60%'],
                            data:dataValue,
                            itemStyle: {
                                normal: {
                                   label: {
                                      show: true, 
                                      //formatter: '{b} : {c} ({d}%)' ,
                                      formatter: '{b} : {c}' ,
                                      textStyle: {
                                         fontSize: fs
                                      }
                                   }
                                },
                                emphasis: {
                                    fontSize:fs,
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                
                myChart.setOption(option);
       }

       //创建阅读内容分析报表
       function createReadContent(data)
       {
            var myChart = echarts.init(document.getElementById('readContent'));
            var indicator =[];
            var maxValue = 0 , minValue = 0 ;
            for (var i = 0 ; i < data.values.length ; i ++) {
                var value = data.values[i];
                if (maxValue < value) {
                    maxValue = value; 
                }
                if (minValue > value) {
                    minValue = value;
                }
            }
            for(var i = 0; i < data.labels.length; i ++){
                //indicator.push({name:data.labels[i]});
                indicator.push({text:data.labels[i],min:minValue,max:maxValue});
            }
            var option = {
                tooltip: {
                    trigger: 'axis'
                },
                radar: [
                    { 
                        name: {
                            show: true,
                            formatter: '{value}',
                            textStyle:{
                                fontSize:fs,
                                color:"#ff7f50"
                            }
                          },
                        indicator: indicator,
                        radius: chartWidth / 3,
                        center: ['50%','50%'],
                    }
                ],
                series: [{
                    name: '阅读内容',
                    type: 'radar',
                     tooltip: {
                        trigger: 'item'
                    },
                    itemStyle: {normal: {areaStyle: {type: 'default'}}},
                    data : [
                        {
                            value : data.values,
                            name : '阅读内容'
                        }
                    ]
                }]
            };
            
            myChart.setOption(option);
       }
       
         //创建阅读能力分析报表
       function createReadAbility(data)
       {
           var myChart = echarts.init(document.getElementById('readAbility'));
           var indicator =[];
            for(var i = 0; i < data.labels.length; i ++)
            {
                indicator.push({text:data.labels[i],max:100,min:10});
            }
           var option = {
                tooltip: {
                    trigger: 'axis'
                },
                radar: [
                    {
                        indicator: indicator,
                        radius: chartWidth / 3,
                        center: ['50%','50%'],
                    }
                ],
                series: [
                    {
                        type: 'radar',
                         tooltip: {
                            trigger: 'item'
                        },
                        itemStyle: {normal: {areaStyle: {type: 'default'}}},
                        data: [
                            {
                                value: data.values,
                                name: '阅读能力'
                            }
                        ]
                    }
                ]
            };
            myChart.setOption(option);
       }
       
       //从小学语文课程标准维度分析
       //从儿童文学鉴赏维度分析
       //从儿童阅读认知心理学维度分析
       function createChatInfo(data,name,id) {
           var myChart = echarts.init(document.getElementById(id));
           var indicator =[];
            for(var i = 0; i < data.labels.length; i ++)
            {
                indicator.push({text:data.labels[i],max:100,min:10});
            }
           var option = {
                tooltip: {
                    trigger: 'axis'
                },
                radar: [
                    {
                        indicator: indicator,
                        radius: chartWidth / 3,
                        center: ['50%','50%'],
                    }
                ],
                series: [
                    {
                        type: 'radar',
                         tooltip: {
                            trigger: 'item'
                        },
                        itemStyle: {normal: {areaStyle: {type: 'default'}}},
                        data: [
                            {
                                value: data.values,
                                name: name
                            }
                        ]
                    }
                ]
            };
            myChart.setOption(option);
       }
    </script>
</html>
