<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/font_awesome4.7/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.icon.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/sign2.css">
        <style type="text/css">
            .sign_detai_bg{
                background-image: url('css/image1/sign_bg.jpg') !important;
                background-size:100% 100%;
                -moz-background-size:100% 100%;
            }
        </style>
    </head>
    <body class="um-vp bc-bg sign_detai_bg" ontouchstart>
        <div class="um-vp detailbox">
        <div class='ub c-gra b-bla uinn' style="background-color: #009688;margin-top: 1em;">
            <div class='ub-f1 ub-ver'>
                <div class='ub-pc tx-c ' style=' padding-top:0.5em;'>
                    <img src="css/icons/ico_headimg.png" class="sign_userimg" id="top3_img_1">
                </div>
                <div class='ub-pc tx-c uinn ulev-1 sign_top3_text' id="rank2">
                    <span class="top3text">亚军</span> <br><span id="top3_1"></span>
                </div>
            </div>
            <div class='ub-f1 ub-ver'>
                <div class='ub-pc tx-c'>
                    <img src="css/icons/ico_headimg.png" class="sign_userimg" id="top3_img_0">
                </div>
                <div class='ub-pc tx-c uinn ulev-1 sign_top3_text' id="rank1">
                    <span class="top3text">冠军</span> <br><span id="top3_0"></span>
                </div>
            </div>
            <div class='ub-f1 ub-ver'>
                <div class='ub-pc tx-c ' style=' padding-top:0.8em;'>
                    <img src="css/icons/ico_headimg.png" class="sign_userimg" id="top3_img_2">
                </div>
                <div class='ub-pc tx-c uinn ulev-1 sign_top3_text' id="rank3">
                   <span class="top3text">季军</span> <br><span id="top3_2"></span>
                </div>
            </div>
        </div>

        <div class='ub c-gra b-bla uinn' style="background-color: #fff;height:2.5em;">
            <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f3' style="height:2.5em; line-height: 2.5em;">
                <div class="sign_rank_num"></div>
                <div  class="sign_rank_img">
                <img src="css/icons/ico_headimg.png" class="sign_list_userimg" style="float:left;" id="current_photo">
                </div>
                <p class="ub-ver ub-pc ub-ac tx-c ulev-1" style="float:left; line-height: 1.5em; margin-left: 1em;text-align: left;">
                    <span class="rank_name" id="current_name"></span><br>
                    第<span id="current_rank"></span>名
                </p>
            </div>
            <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f1' style="height:2.5em;line-height: 2.5em;" id="current_time">
                
            </div>
        </div>

        <div class="ub-f1 ub-ver" style="margin-top: 0.5em;" id="sign_list">
             <!--
             <div class='ub c-gra b-bla uinn sign_list_box'>
                <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f3' style="height:2.5em; ">
                    <div class="sign_list_num">4</div>
                    <div  class="sign_rank_img">
                    <img src="css/icons/book1.png" class="sign_list_userimg" style="float:left;">
                    </div>
                    <p class="ub-ver ub-pc ub-ac tx-c" style="float:left; line-height: 2.5em; margin-left: 1em;text-align: left;">
                        林源
                    </p>
                </div>
                <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f1 ' style="height:2.5em;line-height: 2.5em;">
                    08:29
                </div>
            </div>
            <div class='ub c-gra b-bla uinn sign_list_box'>
                <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f3' style="height:2.5em; ">
                    <div class="sign_list_num">4</div>
                    <div  class="sign_rank_img">
                    <img src="css/icons/book1.png" class="sign_list_userimg" style="float:left;">
                    </div>
                    <p class="ub-ver ub-pc ub-ac tx-c" style="float:left; line-height: 2.5em; margin-left: 1em;text-align: left;">
                        林源
                    </p>
                </div>
                <div class='ub-f1 ub-ver ub-pc ub-ac tx-c ub-f1 ' style="height:2.5em;line-height: 2.5em;">
                    08:29
                </div>
            </div>
            -->
        </div>





        </div>
        

   
 </body>
   
        
        <script src="js/appcan.js"></script>
        <script src="js/appcan.control.js"></script>
        <script src="js/jquery-1.8.3.min.js"></script>
        <script src="js/common.js"></script>
        <script src="js/entity.js"></script>
        <script src="js/swiper.min.js"></script>
        <script src="js/tool.js"></script>
        <script src="js/appcan.tab.js"></script>
    <script>
    
        var pageIndex=1;
        var reloadDate="";
        var reloadJson={"textColor":"#000","imagePath":"res://refesh_icon.png","levelText":"更新日期1","pullToReloadText":"拖动刷新","releaseToReloadText":"释放刷新","loadingText":"刷新中，请稍等"};
        var loadJson={"textColor":"#000","imagePath":"res://refesh_icon.png","levelText":"更新日期2","pullToReloadText":"拖动加载","releaseToReloadText":"释放加载","loadingText":"加载中，请稍等"};
    
    var g_page=1;
    var g_pagecount=1;
    appcan.ready(function() {
        GetList();
        uexWindow.setBounce(1);
        uexWindow.notifyBounceEvent(0,1);
        uexWindow.notifyBounceEvent(1,1);
        uexWindow.showBounceView("0","rgba(0, 0, 0, 0)", 1);
        uexWindow.showBounceView("1","rgba(0, 0, 0, 0)", 1);
        uexWindow.onBounceStateChange = function(type, state){
            var time1 = new Date().format("MM-dd HH:mm:ss");
            switch(type) {
                case 0:
                    if (state == 2) {
                         refreshData();
                    }
                    break;
                case 1:
                    if (state == 2) {
                        loadJson.levelText="上次加载："+time1;
                        uexWindow.setBounceParams(1,JSON.stringify(loadJson));
                       GetList();
                     }
                 break;
            }
        
        }
            var time1 = new Date().format("MM-dd HH:mm:ss");   
            reloadJson.levelText="上次刷新："+time1;
            loadJson.levelText="上次加载："+time1;
            uexWindow.setBounceParams(0,JSON.stringify(reloadJson));
            uexWindow.setBounceParams(1,JSON.stringify(loadJson));
            
    });
    
       function refreshData(){
             g_page=1;
            var time1 = new Date().format("MM-dd HH:mm:ss");   
            reloadJson.levelText="上次刷新："+time1;
             uexWindow.setBounceParams(0,JSON.stringify(reloadJson));
             //$("#reviewList .item").remove();
             $("#sign_list").html("");
            GetList();
       }
    
    function GetList(){
        if (g_page == 1) {
            uexWindow.resetBounceView("0");
        }else {
            uexWindow.resetBounceView("1");
        }
        myPrompt.hide();

        if(g_page>g_pagecount) {
            toast("没有更多签到。",config.toastTimeShort);
            return false;
        }
        

        getUserInfo();
        
        var url = config.serviceUrl + "/sign/rankMonth";
        var par = {"userid" : userInfo.id, "page":g_page};
        var fok = function(data) {
            
            var json = JSON.parse(data);
            g_pagecount = Number(json.pageCount);
            var arr=JSON.parse(json.RankList);

            //1-3名
            if(g_page==1){
                for(var i=0;i<3;i++){
                    
                    if(arr[i]!=null){
                        var time = GetTime(arr[i].signTime);
                        $("#top3_"+i).html(arr[i].name +" " + time)

                        var img =_SERVER_VIDEO_ADDRESS+arr[i].photo; 
                         $("#top3_img_"+i).attr("src",img);
                    }
                }
                
                //当前用户
                var current=JSON.parse(json.CurrentUser);
                var myimg =_SERVER_VIDEO_ADDRESS+current.photo;
                var mytime = GetTime(current.signTime);
                var myname = current.name;
                var myrank = current.rank;
                 $("#current_photo").attr("src",myimg);
                 $("#current_time").html(mytime);
                 $("#current_name").html(myname);
                 $("#current_rank").html(myrank);
                
            }
            
            //列表
            $(arr).each(function(idx,obj){
                if(Number(obj.rank)>3){
                    $("#sign_list").append(GetListHtml(obj));
                }
            })
            g_page++;
            
        };
        var ferr = function(err) {
        };
    
        $.ajax({
            url : url,
            type : 'POST',
            data : par,
            dataType : "html",
            success : fok,
            error : ferr
        });
    }

    function GetTime(timestring){
        return timestring+"次";
    }
    
    function GetListHtml(obj){
        var time=GetTime(obj.signTime)
        var img =_SERVER_VIDEO_ADDRESS+obj.photo; 
        var html="";
            html+='<div class="ub c-gra b-bla uinn sign_list_box">';
            html+=' <div class="ub-f1 ub-ver ub-pc ub-ac tx-c ub-f3" style="height:2.5em; ">';
            html+='     <div class="sign_list_num">'+ obj.rank +'</div>';
            html+='     <div  class="sign_rank_img">';
            html+='     <img src="'+ img +'" class="sign_list_userimg" style="float:left;">';
            html+='     </div>';
            html+='     <p class="ub-ver ub-pc ub-ac tx-c" style="float:left; line-height: 2.5em; margin-left: 1em;text-align: left;">';
            html+='         '+ obj.name ;
            html+='     </p>';
            html+=' </div>';
            html+=' <div class="ub-f1 ub-ver ub-pc ub-ac tx-c ub-f1 " style="height:2.5em;line-height: 2.5em;">';
            html+= time;
            html+=' </div>';
            html+='</div>';
        return html;
    }

    </script>    
</html>
